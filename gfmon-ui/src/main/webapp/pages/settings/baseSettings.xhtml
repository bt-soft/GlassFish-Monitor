<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                 xmlns:h="http://xmlns.jcp.org/jsf/html"
                 xmlns:p="http://primefaces.org/ui"
                 xmlns:f="http://xmlns.jcp.org/jsf/core"
                 xmlns:bt="http://bt-soft.hu/jsf/ui"
                 template="./../../templates/pageTemplate.xhtml"
                 >

    <ui:define name="title">
        #{GFMonUIConstants.SHORT_APP_NAME} - Általános Bállítások
    </ui:define>

    <ui:define name="htmlHead">
        <style type="text/css">
            .category-header-text {
                font-size: 2em;
                font-family: Arial;
                font-weight: bold;
            }
            .sub-category-header-text {
                font-size: 1.4em;
                font-family: Arial;
            }
        </style>
    </ui:define>

    <ui:define name="content">

        <h:form id="settingsForm">

            <bt:disablePanel disabled="#{not isAdmin}">

                <p:panel style="background: transparent; border: none;">
                    <h:outputText value="Általános beállítások" styleClass="category-header-text"/>
                    <p:commandButton value="Beállítások mentése"
                                     icon="fa fa-save"
                                     title="Beállítások mentése az adatbázisba"
                                     actionListener="#{settingsView.saveSettings()}"
                                     update="@form :growl"
                                     style="float: right"
                                     />
                    <!--disabled="#{not settingsView.settingsDataChanged}"-->
                </p:panel>

                <br/>
                <br/>



                <p:panel>
                    <h:outputText value="Működés" styleClass="sub-category-header-text" />

                    <h:panelGrid columns="8" cellpadding="10">
                        <h:outputLabel value="Automatikus indítás: " />
                        <p:inputSwitch value="#{settingsView.configAutoStart}" offLabel="ki" onLabel="be"/>


                        <h:outputLabel value="Mintavétel [mp]: "/>
                        <p:spinner  value="#{settingsView.configSampleInterval}" min="10" max="300" stepFactor="5" size="1" />


                        <h:outputLabel value="Megőrzendő napok száma [db]: "/>
                        <p:spinner  value="#{settingsView.configSampleDataKeepDays}" min="10" max="300" stepFactor="1" size="1" />
                    </h:panelGrid>
                </p:panel>


                <br/>

                <p:panel>
                    <h:outputText value="Monitorozott szerverek" styleClass="sub-category-header-text"/>
                    <p:panel id="tableButtonsPanelGrid"
                             style="background: transparent; border: none;">

                        <p:commandButton id="serverRefreshBtn"
                                         value="Frissít"
                                         title="Szerver lista frissítése"
                                         icon="fa fa-refresh"

                                         actionListener="#{settingsView.refreshServers()}"

                                         onstart="PF('blockUI').block();"
                                         oncomplete="PF('blockUI').unblock();"

                                         update="tableButtonsPanelGrid serversTable appsTable"
                                         />

                        <p:commandButton id="viewBtn"
                                         value="Részletek"
                                         title="A kiválasztott szerver részleteinek megtekintése"
                                         icon="fa fa-id-card-o"
                                         disabled="#{empty settingsView.selectedServer}"
                                         onstart="GfMon.updateAndShowDialog('settingsForm:viewBtn', 'settingsForm', 'viewServerDetailsDlg');"
                                         />

                        <p:commandButton id="newBtn"
                                         value="Új"
                                         title="Új szerver felvétele a listába"
                                         icon="fa fa-plus"

                                         actionListener="#{settingsView.newServerBegin()}"

                                         onsuccess="GfMon.updateAndShowDialog('settingsForm:newBtn', 'settingsForm', 'editServerDetailsDlg');"
                                         />

                        <p:commandButton id="editBtn"
                                         value="Módosítás"
                                         title="A kiválasztott szerver adatainak módosítása"
                                         icon="fa fa-pencil"
                                         disabled="#{empty settingsView.selectedServer}"

                                         actionListener="#{settingsView.modifyBegin()}"

                                         onsuccess="GfMon.updateAndShowDialog('settingsForm:editBtn', 'settingsForm', 'editServerDetailsDlg');"
                                         />

                        <p:commandButton id="deleteBtn"
                                         value="Törlés"
                                         title="A kiválasztott szerver törlése a listából"
                                         icon="fa fa-trash"
                                         disabled="#{empty settingsView.selectedServer}"

                                         actionListener="#{settingsView.delete()}"

                                         update="tableButtonsPanelGrid serversTable appsTable"
                                         >
                            <p:confirm header="Törlés"
                                       message="Biztosan törölni kívánja a(z) '#{settingsView.selectedServer.url}' szervert a listából?"
                                       icon="fa fa-question-circle-o"
                                       />
                        </p:commandButton>
                    </p:panel>

                    <p:dataTable id="serversTable"
                                 value="#{settingsView.servers}"
                                 var="server"

                                 disabledTextSelection="false"

                                 selectionMode="single"
                                 selection="#{settingsView.selectedServer}"

                                 rowIndexVar="rowNdx"
                                 rowKey="#{server.url}"

                                 emptyMessage="Nincs monitorozott szerver"
                                 >


                        <p:ajax event="rowSelect"  update="settingsForm:tableButtonsPanelGrid settingsForm:applicationsPanel :growl" />
                        <p:ajax event="rowUnselect"  update="settingsForm:tableButtonsPanelGrid settingsForm:applicationsPanel :growl" />

                        <p:column headerText="No#"
                                  styleClass="alignCenter"
                                  style="width: 1.5em">
                            <h:outputText value="#{rowNdx + 1}" />
                        </p:column>


                        <p:column headerText="DB id"
                                  rendered="#{isDeveloperMode}"
                                  styleClass="alignCenter"
                                  style="width: 3em"
                                  >
                            <h:outputText value="#{server.id}"/>
                        </p:column>

                        <p:column headerText="DB ver"
                                  rendered="#{isDeveloperMode}"
                                  styleClass="alignCenter"
                                  style="width: 3em"
                                  >
                            <h:outputText value="#{server.optLockVersion}"/>
                        </p:column>

                        <p:column headerText="RT Seq"
                                  rendered="#{isDeveloperMode}"
                                  styleClass="alignCenter"
                                  style="width: 3em"
                                  >
                            <h:outputText value="#{server.runtimeSeqId}"/>
                        </p:column>

                        <p:column headerText="Aktív"
                                  styleClass="alignCenter"
                                  style="width: 3em"
                                  >
                            <i class="fa #{server.active ? 'fa-check-square-o' : 'fa-square-o'}" aria-hidden="true"/>
                        </p:column>

                        <p:column headerText="URL">
                            <h:outputText value="#{server.url}"/>
                        </p:column>

                        <p:column headerText="App RexExp filter">
                            <h:outputText value="#{server.regExpFilter}"/>
                        </p:column>

                        <p:column headerText="Leírás">
                            <h:outputText value="#{server.description}"/>
                        </p:column>

                        <p:column headerText="KiegInfó">
                            <h:outputText value="#{server.additionalInformation}"/>
                        </p:column>

                    </p:dataTable>


                    <br/>

                    <h:outputText value="Alkalmazások"
                                  styleClass="sub-category-header-text"
                                  />
                    <p:scrollPanel  mode="native" style="border: none; padding: 0; margin: 0">
                        <p:panel id="applicationsPanel" style="background: transparent; border: none;">

                            <p:commandButton id="appRefreshBtn"
                                             value="Frissít"
                                             icon="fa fa-refresh"
                                             title="A szerver alkalmazásainak újbóli lekérdezése"
                                             actionListener="#{settingsView.refreshApplications}"
                                             onstart="PF('blockUI').block();"
                                             oncomplete="PF('blockUI').unblock();"
                                             disabled="#{empty settingsView.selectedServer or not settingsView.selectedServer.active}"
                                             update="appsTable"
                                             />

                            <p:commandButton value="Összes aktív"
                                             icon="fa fa-check-square-o"
                                             title="Minden gyűjtendő adatnév aktív"
                                             onstart="PF('blockUI').block();"
                                             oncomplete="PF('blockUI').unblock();"
                                             actionListener="#{settingsView.toggleAllAppActiveFlag(true)}"
                                             update="appsTable :growl"
                                             disabled="#{empty settingsView.selectedServer or not settingsView.selectedServer.active}"
                                             />


                            <p:commandButton value="Összes inaktív"
                                             icon="fa fa-square-o"
                                             title="Minden gyűjtendő adatnév inaktív"
                                             actionListener="#{settingsView.toggleAllAppActiveFlag(false)}"
                                             onstart="PF('blockUI').block();"
                                             oncomplete="PF('blockUI').unblock();"
                                             update="appsTable :growl"
                                             disabled="#{empty settingsView.selectedServer or not settingsView.selectedServer.active}"
                                             />


                            <p:dataTable id="appsTable"
                                         widgetVar="appsTable"

                                         value="#{settingsView.selectedServer.applications}"
                                         var="app"

                                         multiViewState="false"
                                         disabledTextSelection="false"

                                         editable="true"
                                         editMode="cell"

                                         rowIndexVar="rowNdx"
                                         rowKey="#{app.id}"

                                         emptyMessage="Nincsenek alkalmazások"
                                         >

                                <p:column headerText="No#"
                                          styleClass="alignCenter"
                                          style="width: 1.5em">
                                    <h:outputText value="#{rowNdx + 1}" />
                                </p:column>

                                <!--
                                <p:column headerText="id"
                                          style="width: 4em"
                                          rendered="#{isDeveloperMode}">
                                    <h:outputText value="#{app.id}" />
                                </p:column>
                                <p:column headerText="srvId"
                                          style="width: 4em"
                                          rendered="#{isDeveloperMode}">
                                    <h:outputText value="#{app.server.id}" />
                                </p:column>
                                -->

                                <p:column headerText="Monable"
                                          styleClass="alignCenter"
                                          style="width: 4em"
                                          >
                                    <p:selectBooleanCheckbox value="#{app.active}">
                                        <!--<p:ajax event="valueChange" update="appsTable"/>-->
                                    </p:selectBooleanCheckbox>
                                </p:column>


                                <p:column headerText="App SName"
                                          style="width: 15em"
                                          sortBy="#{app.appShortName}"
                                          filterBy="#{app.appShortName}"
                                          filterStyle="width: 10em; font-size: 0.6em"
                                          filterMatchMode="contains"
                                          >
                                    <h:outputText value="#{app.appShortName}" />
                                </p:column>
                                <p:column headerText="App RName"
                                          style="width: 15em"
                                          sortBy="#{app.appRealName}"
                                          filterBy="#{app.appRealName}"
                                          filterStyle="width: 10em; font-size: 0.6em"
                                          filterMatchMode="contains"
                                          >
                                    <h:outputText value="#{app.appRealName}" />
                                </p:column>

                                <p:column headerText="Module SName"
                                          style="width: 15em"
                                          sortBy="#{app.moduleShortName}"
                                          filterBy="#{app.moduleShortName}"
                                          filterStyle="width: 10em; font-size: 0.6em"
                                          filterMatchMode="contains"
                                          >
                                    <h:outputText value="#{app.moduleShortName}" />
                                </p:column>
                                <p:column headerText="Module RName"
                                          style="width: 15em"
                                          sortBy="#{app.moduleRealName}"
                                          filterBy="#{app.moduleRealName}"
                                          filterStyle="width: 10em; font-size: 0.6em"
                                          filterMatchMode="contains"
                                          >
                                    <h:outputText value="#{app.moduleRealName}" />
                                </p:column>

                                <p:column headerText="ContextRoot">
                                    <h:outputText value="#{app.contextRoot}" />
                                </p:column>
                                <p:column headerText="Enabled"
                                          style="width: 4em"
                                          styleClass="alignCenter">
                                    <p:selectBooleanCheckbox value="#{app.enabled}" disabled="true"/>
                                </p:column>
                                <p:column headerText="Leírás">
                                    <h:outputText value="#{app.description}"/>
                                </p:column>

                                <p:column headerText="Létrehozva"
                                          style="width: 10em"
                                          >
                                    <h:outputText value="#{app.createdDate}">
                                        <f:convertDateTime pattern="yyyy.MM.dd HH:mm:ss"
                                                           timeZone="Europe/Budapest"
                                                           locale="hu_HU"/>
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="Létrehozó"
                                          style="width: 8em"
                                          >
                                    <h:outputText value="#{app.createdBy}"/>
                                </p:column>

                                <p:column headerText="Módosítva"
                                          style="width: 10em"
                                          >
                                    <h:outputText value="#{app.modifiedDate}">
                                        <f:convertDateTime pattern="yyyy.MM.dd HH:mm:ss"
                                                           timeZone="Europe/Budapest"
                                                           locale="hu_HU"/>
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="Módosító"
                                          style="width: 8em"
                                          >
                                    <h:outputText value="#{app.modifiedBy}"/>
                                </p:column>


                            </p:dataTable>
                        </p:panel>
                    </p:scrollPanel>
                </p:panel>

            </bt:disablePanel>
        </h:form>


        <ui:include src="../../dialogs/server/viewServerDetailsDlg.xhtml" />
        <ui:include src="../../dialogs/server/editServerDetailsDlg.xhtml" />

    </ui:define>

</ui:composition>

<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                 xmlns:h="http://xmlns.jcp.org/jsf/html"
                 xmlns:p="http://primefaces.org/ui"
                 xmlns:pe="http://primefaces.org/ui/extensions"
                 xmlns:f="http://xmlns.jcp.org/jsf/core"
                 xmlns:bt="http://bt-soft.hu/jsf/ui"
                 template="./../../templates/pageTemplate.xhtml"
                 >

    <ui:define name="title">
        #{GFMonUIConstants.SHORT_APP_NAME} - Gyűjtendő szerver adatok
    </ui:define>

    <ui:define name="htmlHead">
        <style type="text/css">
            .category-header-text {
                font-size: 2em;
                font-family: Arial;
                font-weight: bold;
            }
            .sub-category-header-text {
                font-size: 1.4em;
                font-family: Arial;
            }
        </style>
    </ui:define>

    <ui:define name="content">
        <h:outputText value="Gyűjtendő adatok" styleClass="category-header-text"/>
        <br/>
        <br/>

        <bt:disablePanel disabled="#{not isAdmin}">


            <h:form id="cdusForm">


                <h:panelGrid columns="2" style="width: 100%">
                    <h:panelGrid columns="4">
                        <h:outputLabel for="server" value="Szerver: "/>
                        <p:selectOneMenu id="server"
                                         value="#{collectorSettingsView.selectedServerId}"
                                         editable="false"
                                         >
                            <f:selectItems value="#{collectorSettingsView.servers}"
                                           var="server"
                                           itemLabel="#{server.url}"
                                           itemValue="#{server.id}"
                                           />
                            <p:ajax onstart="PF('blockUI').block();"
                                    oncomplete="PF('blockUI').unblock();"
                                    listener="#{collectorSettingsView.selectedServerChanged()}"
                                    update="cdusTable"
                                    />
                        </p:selectOneMenu>

                        <p:commandButton value="Összes aktív"
                                         icon="fa fa-check-square-o"
                                         title="Minden gyűjtendő adatnév aktív"
                                         onstart="PF('blockUI').block();"
                                         oncomplete="PF('blockUI').unblock();"
                                         actionListener="#{collectorSettingsView.toggleAllDcuActiveFlag(true)}"
                                         update="@form :growl"
                                         />

                        <p:commandButton value="Összes inaktív"
                                         icon="fa fa-square-o"
                                         title="Minden gyűjtendő adatnév inaktív"
                                         actionListener="#{collectorSettingsView.toggleAllDcuActiveFlag(false)}"
                                         onstart="PF('blockUI').block();"
                                         oncomplete="PF('blockUI').unblock();"
                                         update="@form :growl"
                                         />
                    </h:panelGrid>
                    <p:commandButton value="Beállítások mentése"
                                     icon="fa fa-save"
                                     title="Beállítások mentése az adatbázisba"
                                     actionListener="#{collectorSettingsView.saveSettings()}"
                                     onstart="PF('blockUI').block();"
                                     oncomplete="PF('blockUI').unblock();"
                                     update="@form :growl"
                                     style="float: right"
                                     />
                </h:panelGrid>

                <p:scrollPanel  mode="native" style="border: none; padding: 0; margin: 0;">
                    <p:dataTable id="cdusTable"
                                 widgetVar="cdusTable"

                                 value="#{collectorSettingsView.selectedServer.joiners}"
                                 var="joiner"

                                 scrollable="true"

                                 scrollHeight="600"

                                 multiViewState="false"
                                 disabledTextSelection="false"

                                 editable="true"
                                 editMode="cell"

                                 rowIndexVar="rowNdx"
                                 rowKey="#{joiner.svrCollectorDataUnitId}"

                                 emptyMessage="Nincs Adat"
                                 >

                        <p:column headerText="No#"
                                  styleClass="alignCenter"
                                  style="width: 1.5em">
                            <h:outputText value="#{rowNdx + 1}" />
                        </p:column>

                        <p:column headerText="active"
                                  styleClass="alignCenter"
                                  sortBy="{joiner.active}"
                                  style="width: 3em"
                                  >
                            <p:selectBooleanCheckbox value="#{joiner.active}">
                                <p:ajax event="valueChange"  update="cdusTable" listener="#{collectorSettingsView.joinerActiveChanged(joiner.svrCollectorDataUnitId)}"/>
                            </p:selectBooleanCheckbox>
                        </p:column>


                        <p:column headerText="!!"
                                  styleClass="alignCenter"
                                  sortBy="#{joiner.additionalMessage}"
                                  style="width: 2em; color: #{collectorSettingsView.warningExisInDcus() ? 'orange' : 'silver'}; font-weight: #{collectorSettingsView.warningExisInDcus() ? 'bold' : null}">

                            <p:outputLabel id="emptyLabel"
                                           rendered="#{not empty joiner.additionalMessage}">
                                <i id="warningIcon"
                                   class="fa fa-exclamation-triangle"
                                   style="color: orange"
                                   />
                                <pe:tooltip for="emptyLabel"
                                            showEffect="fadeIn" hideEffect="slideToggle"
                                            header="Figyelem">
                                    <h:panelGrid columns="2" style="font-size: 0.9em" styleClass="top-aligned-columns" columnClasses="viewDlgTblPrompt">
                                        <p:outputLabel value="Módosító: "/>
                                        <h:outputText value="#{joiner.modifiedBy}" escape="false"/>

                                        <p:outputLabel value="Időpont: "/>
                                        <h:outputText value="#{joiner.modifiedDate}" escape="false">
                                            <f:convertDateTime pattern="yyyy.MM.dd HH:mm:ss"
                                                               timeZone="Europe/Budapest"
                                                               locale="hu_HU"/>
                                        </h:outputText>

                                        <p:outputLabel value="KiegInfó: "/>
                                        <h:outputText value="#{joiner.additionalMessage}" escape="false"/>
                                    </h:panelGrid>
                                </pe:tooltip>
                            </p:outputLabel>

                        </p:column>



                        <!--
                        <p:column headerText="srvId"
                                  style="width: 4em"
                                  rendered="#{isDeveloperMode}">
                            <h:outputText value="#{joiner.serverId}" />
                        </p:column>

                        <p:column headerText="dcuId"
                                  style="width: 4em"
                                  rendered="#{isDeveloperMode}">
                            <h:outputText value="#{joiner.svrCollectorDataUnitId}" />
                        </p:column>
                        -->

                        <p:column headerText="restPath"
                                  style="width: 20em"
                                  sortBy="#{joiner.svrCollectorDataUnit.restPath}"
                                  filterBy="#{joiner.svrCollectorDataUnit.restPath}"
                                  filterStyle="width: 10em; font-size: 0.6em"
                                  filterMatchMode="contains"
                                  >
                            <h:outputText value="#{joiner.svrCollectorDataUnit.restPath}" />
                        </p:column>

                        <p:column headerText="dataName"
                                  style="width: 15em"
                                  sortBy="#{joiner.svrCollectorDataUnit.dataName}"
                                  filterBy="#{joiner.svrCollectorDataUnit.dataName}"
                                  filterStyle="width: 10em; font-size: 0.6em"
                                  filterMatchMode="contains"
                                  >
                            <h:outputText value="#{joiner.svrCollectorDataUnit.dataName}" />
                        </p:column>

                        <p:column headerText="unit"
                                  style="width: 6em"
                                  sortBy="#{joiner.svrCollectorDataUnit.unit}"
                                  >
                            <h:outputText value="#{joiner.svrCollectorDataUnit.unit}" />
                        </p:column>

                        <p:column headerText="description" style="width: 80em">
                            <h:outputText value="#{joiner.svrCollectorDataUnit.description}" />
                        </p:column>
                    </p:dataTable>

                </p:scrollPanel>

            </h:form>

        </bt:disablePanel>

    </ui:define>

</ui:composition>
